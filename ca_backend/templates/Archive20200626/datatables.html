{% extends "base.html" %}

{% block PageCustomStyles %}
	<link href="{{url_for('static', filename='vendor/datatables/dataTables.bootstrap4.min.css')}}" rel="stylesheet">
	<link href="{{url_for('static', filename='vendor/datatables/select.dataTables.min.css')}}" rel="stylesheet">
	<link href="{{url_for('static', filename='vendor/datatables/buttons.dataTables.min.css')}}" rel="stylesheet">

	<style>
	.popover {
		max-width: 600px;
	}
	</style>

{% endblock %}

{% block content %}

    <!-- Begin Page Content -->
    <div class="container-fluid">

        <!-- DataTales Example -->
        <div class="card shadow mb-4">
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <div>
                    <h2>所有景點</h2>
                </div>
            </div>

            <div class="card-body">
                <div class="tab-content" id="myTabContent">

					<table class="table table-striped table-bordered table-sm" id="datatable" width="100%" cellspacing="0">
						<thead>
							<tr>
								<th style="width:60px">Action</th>
								{% for col in columns %}
								<th>{{ col }}</th>
								{% endfor %}
							</tr>
						</thead>
					</table>

                </div>
            </div>
        </div>

		<!-- Content Row -->
		<div class="card shadow mb-4">

			<div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
				<h6 class="m-0 font-weight-bold text-primary">目前選擇的景點</h6>
			</div>

			<div class="card-body">
				<div class="table-responsive">

					<table class="table table-striped table-bordered table-sm" id="dataTable_select" width="100%"
						cellspacing="0">
						<thead>
							<tr>
								<th style="width:60px">Action</th>
								{% for col in columns %}
								<th>{{ col }}</th>
								{% endfor %}
							</tr>
						</thead>
					</table>

				</div>
			</div>

		</div>

    </div>
    <!-- /.container-fluid -->

{% endblock %}

{% block PageCustomScripts %}
	<!-- Page level plugins -->
	<script src="{{url_for('static', filename='vendor/datatables/jquery.dataTables.min.js')}}"></script>
	<script src="{{url_for('static', filename='vendor/datatables/dataTables.bootstrap4.min.js')}}"></script>

	<script src="{{url_for('static', filename='vendor/datatables/dataTables.select.min.js')}}"></script>
	<script src="{{url_for('static', filename='vendor/datatables/dataTables.buttons.min.js')}}"></script>

	<script>
		var selTable = undefined;
		var myTable = undefined;


		$(document).ready(function() {

			selTable = $('#dataTable_select').DataTable();

			myTable = $('#datatable').DataTable( {
				"Dom": "<'row-fluid'<'span6 toolbar'><'span6'>r>t<'row-fluid'<'span6'f><'span6'p>>",
				"processing": true,
				"ajax": {
					"url": "{{ url_for('api.scenice') | safe}}",
					"data": function ( d ) {
						d.extra_search = $('#extra').val();
					}
				},
				"drawCallback": function (oSettings) {
                    $('[data-toggle="popover"]').popover({
                        html: true,
                        trigger: 'focus',
                        placement: 'auto'
                    });

					//$('.Select_item').on('click',function(){
						//selTable.row.add(this);
					//	console.log($(this).attr('id'));
						//myTable.row(this).remove().draw();
					//});

				},
				"columns":[
					{
                        orderable: false,
                        data: null,
						render: function ( data, type, row, meta ) {
							var dtb = document.createElement("BUTTON");
							dtb.id = data.Id;
							dtb.className = 'Select_item btn btn-sm btn-outline-danger btn-circle';
							dtb.type = 'button';
							dtb.value = data.Location;
							dtb.innerHTML = '<i class="far fa-trash-alt"></i>';
							return dtb.outerHTML
							//return '<button id="'+data.Id+'" type="button" class="Select_item btn btn-sm btn-outline-danger btn-circle"><i class="far fa-trash-alt"></i></button>';
						}
                    },
					{
						data:"Name"
					},
					{
						data:"Toldescribe",
						render: function ( data, type, row, meta ) {
							return '<button tabindex="0" style="width: 100%;" class="btn btn-sm btn-success" data-toggle="popover" title="'+row.Name+'" data-content="' + data + '">Show</button>';
						}
					},
					{
						data:"Add"
					},
					{
						data:"Tel"
					}
				]
			});
		} );

		$('#datatable').on('click', 'tbody tr', function () {
			$('.Select_item').on('click',function(){
				var id = ($(this).attr('value'));
				//console.log(this);
			});
			selTable.row.add(this).draw('full-reset');
			myTable.row(this).remove().draw('full-reset');
			console.log(this);
		});
		
	</script>

{% endblock %}
